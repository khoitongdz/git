<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="icon" href="https://icons.veryicon.com/png/Application/Mavrick/Mail.png">
    <title>üìß Temp Mail</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e272e;
            color: #f5f6fa;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            width: 90%;
            max-width: 900px;
            background-color: #2f3640;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 20px;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .banner {
            background-color: #44bd32;
            color: white;
            font-weight: bold;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(68, 189, 50, 0.3);
            transition: background-color 0.3s ease;
        }

        .banner.new-mail {
            background-color: #fbc531;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #fbc531;
        }

        .email-input {
            width: 100%;
            padding: 12px;
            font-family: 'Consolas', monospace;
            font-size: 16px;
            background-color: #1e272e;
            color: #f5f6fa;
            border: none;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: box-shadow 0.3s ease;
        }

        .email-input:focus {
            box-shadow: inset 0 2px 5px rgba(68, 189, 50, 0.5);
        }

        .btn-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 12px 24px;
            font-size: 14px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-copy { background-color: #44bd32; }
        .btn-refresh { background-color: #273c75; }
        .btn-new { background-color: #e84118; }

        .timer {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: #fbc531;
            margin-bottom: 15px;
            transition: color 0.3s ease;
        }

        .timer.expired {
            color: #e84118;
        }

        .inbox {
            background-color: #1e272e;
            border-radius: 8px;
            padding: 15px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.5;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
            scrollbar-width: thin;
            scrollbar-color: #44bd32 #2f3640;
            transition: opacity 0.3s ease;
        }

        .inbox.refreshing {
            opacity: 0.7;
        }

        .inbox::-webkit-scrollbar {
            width: 8px;
        }

        .inbox::-webkit-scrollbar-track {
            background: #2f3640;
        }

        .inbox::-webkit-scrollbar-thumb {
            background-color: #44bd32;
            border-radius: 20px;
            border: 2px solid #2f3640;
        }

        .mail-item {
            border-bottom: 1px solid #3d5466;
            padding: 10px 0;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .mail-from { color: #44bd32; font-weight: bold; }
        .mail-subject { color: #fbc531; font-weight: bold; }
        .mail-body { color: #f5f6fa; white-space: pre-wrap; }

        .no-mail {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }

        .expired {
            color: #e84118;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="banner" class="banner">‚ú® Welcome to TempMail Pro</div>
        <div class="title">üìß TEMP MAIL 10 MINUTES</div>
        <input id="email" class="email-input" readonly value="ƒêang t·∫°o email...">
        <div class="btn-container">
            <button class="btn btn-copy" onclick="copyEmail()">üìã Copy</button>
            <button class="btn btn-refresh" onclick="refreshInbox()">üîÑ Refresh</button>
            <button class="btn btn-new" onclick="newEmail()">‚ú® T·∫°o email m·ªõi</button>
        </div>
        <div id="timer" class="timer">‚è≥ C√≤n l·∫°i: 10:00</div>
        <div id="inbox" class="inbox"></div>
    </div>

    <script>
        const MAILTM_BASE = "https://api.mail.tm";
        const SECMAIL_BASE = "https://www.1secmail.com/api/v1/";
        const GUERRILLA_BASE = "https://api.guerrillamail.com/ajax.php";
        const MAILNESIA_BASE = "https://mailnesia.com/mailbox/";

        let provider, email, token, username, domain, sid_token;
        let expireTime, timerInterval, refreshInterval;
        let oldMailIds = new Set();

        function genPassword(length = 12) {
            const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            return Array.from({length}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
        }

        async function createMailtm() {
            try {
                const domainsRes = await fetch(`${MAILTM_BASE}/domains`);
                const domains = await domainsRes.json();
                const domain = domains['hydra:member'][0].domain;

                const username = Array.from({length: 8}, () => 'abcdefghijklmnopqrstuvwxyz'[Math.floor(Math.random() * 26)]).join('');
                const address = `${username}@${domain}`;
                const password = genPassword();

                const data = {address, password};
                await fetch(`${MAILTM_BASE}/accounts`, {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)});

                const tokenRes = await fetch(`${MAILTM_BASE}/token`, {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)});
                const tokenJson = await tokenRes.json();
                if (!tokenJson.token) return null;
                return {provider: 'mailtm', address, password, token: tokenJson.token};
            } catch (e) {
                return null;
            }
        }

        async function create1sec() {
            try {
                const res = await fetch(`${SECMAIL_BASE}?action=genRandomMailbox&count=1`);
                const data = await res.json();
                const address = data[0];
                const [usr, dom] = address.split('@');
                return {provider: '1sec', address, username: usr, domain: dom};
            } catch (e) {
                return null;
            }
        }

        async function createGuerrilla() {
            try {
                const res = await fetch(`${GUERRILLA_BASE}?f=get_email_address`);
                const data = await res.json();
                return {provider: 'guerrilla', address: data.email_addr, sid_token: data.sid_token};
            } catch (e) {
                return null;
            }
        }

        function createMailnesia() {
            try {
                const username = Array.from({length: 8}, () => 'abcdefghijklmnopqrstuvwxyz'[Math.floor(Math.random() * 26)]).join('');
                const address = `${username}@mailnesia.com`;
                return {provider: 'mailnesia', address, username};
            } catch (e) {
                return null;
            }
        }

        async function getMailtmInbox(token) {
            const res = await fetch(`${MAILTM_BASE}/messages`, {headers: {'Authorization': `Bearer ${token}`}});
            const data = await res.json();
            return data['hydra:member'] || [];
        }

        async function readMailtm(token, msgId) {
            const res = await fetch(`${MAILTM_BASE}/messages/${msgId}`, {headers: {'Authorization': `Bearer ${token}`}});
            return await res.json();
        }

        async function get1secInbox(username, domain) {
            const res = await fetch(`${SECMAIL_BASE}?action=getMessages&login=${username}&domain=${domain}`);
            return await res.json();
        }

        async function read1sec(username, domain, msgId) {
            const res = await fetch(`${SECMAIL_BASE}?action=readMessage&login=${username}&domain=${domain}&id=${msgId}`);
            return await res.json();
        }

        async function getGuerrillaInbox(sid_token) {
            const res = await fetch(`${GUERRILLA_BASE}?f=get_email_list&offset=0&sid_token=${sid_token}`);
            const data = await res.json();
            return data.list || [];
        }

        async function readGuerrilla(sid_token, mailId) {
            const res = await fetch(`${GUERRILLA_BASE}?f=fetch_email&sid_token=${sid_token}&email_id=${mailId}`);
            return await res.json();
        }


        async function newEmail() {
            let acc = await createMailtm();
            if (acc) {
                provider = 'mailtm';
                email = acc.address;
                token = acc.token;
                username = domain = sid_token = null;
            } else {
                acc = await create1sec();
                if (acc) {
                    provider = '1sec';
                    email = acc.address;
                    username = acc.username;
                    domain = acc.domain;
                    token = sid_token = null;
                } else {
                    acc = await createGuerrilla();
                    if (acc) {
                        provider = 'guerrilla';
                        email = acc.address;
                        sid_token = acc.sid_token;
                        username = domain = token = null;
                    } else {
                        acc = createMailnesia();
                        if (acc) {
                            provider = 'mailnesia';
                            email = acc.address;
                            username = acc.username;
                            token = sid_token = domain = null;
                        } else {
                            document.getElementById('banner').innerText = '‚ùå Kh√¥ng t·∫°o ƒë∆∞·ª£c email t·ª´ b·∫•t k·ª≥ API n√†o!';
                            return;
                        }
                    }
                }
            }

            expireTime = Date.now() + 600000; // 10 minutes
            document.getElementById('email').value = email;
            document.getElementById('inbox').innerHTML = '';
            oldMailIds = new Set();
            updateTimer();
            autoRefresh();
            document.getElementById('banner').innerText = `‚úÖ Email m·ªõi: ${email}`;
            document.getElementById('banner').classList.remove('new-mail');
        }

        function copyEmail() {
            navigator.clipboard.writeText(email);
            document.getElementById('banner').innerText = `üìã ƒê√£ copy email: ${email}`;
            document.getElementById('banner').classList.remove('new-mail');
        }

        async function refreshInbox() {
            if (Date.now() > expireTime) {
                document.getElementById('inbox').innerHTML = '<div class="expired">‚õî Email ƒë√£ h·∫øt h·∫°n (10 ph√∫t).</div>';
                document.getElementById('timer').classList.add('expired');
                return;
            }

            const inboxEl = document.getElementById('inbox');
            inboxEl.classList.add('refreshing');

            let mails = [];
            if (provider === 'mailtm') {
                const inbox = await getMailtmInbox(token);
                for (let m of inbox) {
                    const msg = await readMailtm(token, m.id);
                    mails.push({id: m.id, from: m.from.address, subject: m.subject, body: msg.text || ''});
                }
            } else if (provider === '1sec') {
                const inbox = await get1secInbox(username, domain);
                for (let m of inbox) {
                    const msg = await read1sec(username, domain, m.id);
                    mails.push({id: m.id, from: m.from, subject: m.subject, body: msg.body || msg.textBody || ''});
                }
            } else if (provider === 'guerrilla') {
                const inbox = await getGuerrillaInbox(sid_token);
                for (let m of inbox) {
                    const msg = await readGuerrilla(sid_token, m.mail_id);
                    mails.push({id: m.mail_id, from: m.mail_from, subject: m.mail_subject, body: msg.mail_body || msg.mail_excerpt || ''});
                }
            } // Mailnesia b·ªè qua

            inboxEl.innerHTML = '';
            let newMailFound = false;

            mails.forEach(m => {
                const item = document.createElement('div');
                item.className = 'mail-item';
                item.innerHTML = `
                    <div class="mail-from">üë§ From: ${m.from}</div>
                    <div class="mail-subject">üìå Subject: ${m.subject}</div>
                    <div class="mail-body">üìù Body: ${m.body}</div>
                    <hr style="border-color: #3d5466;">
                `;
                inboxEl.appendChild(item);

                if (!oldMailIds.has(m.id)) {
                    newMailFound = true;
                }
            });

            oldMailIds = new Set(mails.map(m => m.id));

            if (newMailFound) {
                document.getElementById('banner').innerText = 'üîî B·∫°n c√≥ th∆∞ m·ªõi!';
                document.getElementById('banner').classList.add('new-mail');
            }

            if (mails.length === 0) {
                inboxEl.innerHTML = '<div class="no-mail">üì≠ Ch∆∞a c√≥ th∆∞...</div>';
            }

            inboxEl.classList.remove('refreshing');
        }

        function autoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInbox();
            refreshInterval = setInterval(refreshInbox, 10000); // Changed to 10 seconds
        }

        function updateTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const remaining = Math.max(0, expireTime - Date.now());
                if (remaining > 0) {
                    const mins = Math.floor(remaining / 60000);
                    const secs = Math.floor((remaining % 60000) / 1000);
                    document.getElementById('timer').innerText = `‚è≥ C√≤n l·∫°i: ${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                    document.getElementById('timer').classList.remove('expired');
                } else {
                    document.getElementById('timer').innerText = '‚õî Email ƒë√£ h·∫øt h·∫°n!';
                    document.getElementById('timer').classList.add('expired');
                    document.getElementById('email').value = 'H·∫æT H·∫†N';
                    document.getElementById('inbox').innerHTML = '<div class="expired">‚õî Email h·∫øt h·∫°n, b·∫•m \'‚ú® T·∫°o email m·ªõi\' ƒë·ªÉ t·∫°o l·∫°i.</div>';
                    clearInterval(timerInterval);
                    clearInterval(refreshInterval);
                }
            }, 1000);
        }

        // Kh·ªüi ƒë·ªông
        newEmail();
    </script>
</body>
</html>
